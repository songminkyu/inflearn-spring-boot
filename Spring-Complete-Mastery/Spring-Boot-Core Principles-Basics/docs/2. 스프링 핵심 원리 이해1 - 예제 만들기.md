# 스프링 핵심 원리 #2  

<br/>

# ✔ 목차
* 비즈니스 요구사항과 설계
* 회원 도메인 설계
* 회원 도메인 설계의 문제점
* 주문과 할인 도메인 설계
  
<br/>

# 💡 비즈니스 요구사항과 설계

## **회원**

* 회원을 가입하고 조회할 수 있다.
* 회원은 일반과 VIP 두 가지 등급이 있다.
* 회원 데이터는 자체 DB를 구축할 수 있고, 외부 시스템과 연동할 수 있다. (미확정)

## **주문과 할인 정책**

* 회원은 상품을 주문할 수 있다.
* 회원 등급에 따라 할인 정책을 적용할 수 있다.
* 할인 정책은 모든 VIP는 1000원을 할인해주는 고정 금액 할인을 적용한다. (나중에 변경 될 수 있다.)
* 할인 정책은 변경 가능성이 높다. 회사의 기본 할인 정책을 아직 정하지 못했고, 오픈 직전까지 고민을 미루고 싶다. 최악의 경우 할인을 적용하지 않을 수 도 있다. (미확정)

## **문제점**

요구사항을 보면 회원 데이터, 할인 정책 같은 부분은 지금 결정하기 어려운 부분이다. 그러면 정책이 결정될 때 까지 개발을 기다려야할까?

## **해결 방법**

객체 지향 프로그래밍의 핵심 **다형성**을 활용해 설계해보자. 인터페이스(역활)를 만들고 구현 객체를 언제든 갈아끼울 수 있도록 설계하면 된다.

<br/>

# 💡 회원 도메인 설계

## **도메인**

해결하고자 하는 문제 영역, 개발자 입장에서 소프트웨어를 개발하는 대상 영역정도로 이해하면된다. 택시 앱을 만든다면 택시 기사님을 콜하고, 탑승하고, 요금을 지불하는 전 과정이 도메인이된다.

<br/>

## **도메인 모델**

도메인을 모든 사람이 동일한 관점에서 이해할 수 있고 공유할 수 있도록 단순화시킨 것이다. 꼭 클래스 다이어그램 형식으로 표현할 필요는 없지만, 객체 지향 프로그래밍을 하는 경우 일반적으로 클래스 다이어그램의 표기법을 사용해서 도메인 모델을 정리하는 것이 유용하다.  
그 이유는 객체 지향 패러다임에서 사용하는 유사한 기법에 기반하는게, 코드와 모델을 유사한 형태로 유지하는데 이롭기도 하고 일단 도메인 모델을 이해하면 그 모델을 기반으로 코드를 쉽게 이해하고 수정할 수 있기 때문이다.

<br/>

## **회원 도메인 협력 관계**

**도메인 협력 관계**  

요구사항 분석 과정에서 이해관계자들의 소통의 도구로 활용, 기획자도 볼 수 있는 그림

![2](https://user-images.githubusercontent.com/55661631/106770581-797d4800-6681-11eb-8b6c-b34af23dfb4a.PNG)


<br/>

## **회원 클래스 다이어그램**

**클래스 다이어그램**  

도메인 협력 관계를 보고 개발자들이 구체화한 다이어그램, 동적인 부분은 고려하지 않고 모든 것을 보여준다(정적).

![3](https://user-images.githubusercontent.com/55661631/106770856-b8130280-6681-11eb-8605-5129dde7a4a7.PNG)


<br/>

## **회원 객체 다이어그램**

**객체 다이어그램**  

서버가 올라갔을 때 클라이언트가 실제로 사용하는 인스턴스끼리의 참조 관계를 보여주며, 동적인 부분을 고려한다.

![5](https://user-images.githubusercontent.com/55661631/106771161-06280600-6682-11eb-9fd6-0a6f0cb0f642.PNG)
  
<br/>

> ### **참고** 
> 위 다이어그램들은 UML 표기법에 따르지 않고, 이해를 위해 의존 관계를 표현한 것이다.  
> 인터페이스와 구현 객체는 다른 패키지에 넣는 것이 더 좋은 구조이다.

<br/>

# 💡 회원 도메인 설계의 문제점

* Repository(저장소)를 다른 저장소로 변경할 때 OCP 원칙을 준수하지 못한다.

* 회원 서비스가 저장소의 인터페이스(추상화)와 구현 객체(구체화) 모두에 의존하므로 DIP를 위반한다.

<br/>

# 💡 주문과 할인 도메인 설계

## **주문 도메인 전체**

![6](https://user-images.githubusercontent.com/55661631/106773441-6455e880-6684-11eb-904b-6a6ffd1ffbbf.png)

1. **주문 생성** : 클라이언트는 주문 서비스에 주문 생성을 요청한다.
2. **회원 조회** : 할인을 위해서는 회원 등급이 필요하다. 그래서 주문 서비스는 회원 저장소에서 회원을 조회
한다.
3. **할인 적용** : 주문 서비스는 회원 등급에 따른 할인 여부를 할인 정책에 위임한다.
4. **주문 결과 반환** : 주문 서비스는 할인 결과를 포함한 주문 결과를 반환한다.

<br/>

### **회원을 메모리가 아닌 실제 DB에서 조회하고, 정률 할인 정책(주문 금액에 따라 % 할인)을 지원해도 주문 서비스를 변경하지 않아도 된다. 구현 객체를 갈아끼우면된다.**

<br/>

> ### **참고**  
> 실제로는 주문 데이터를 DB에 저장하겠지만, 예제가 너무 복잡해 질 수 있어서 생략하고, 단순히 주문 결과를 반환한다.

<br/>

# 참고

* [인프런 스프링 핵심 원리](https://www.inflearn.com/)
